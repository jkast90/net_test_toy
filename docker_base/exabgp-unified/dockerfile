# exabgp-unified: ExaBGP daemon + unified API in one container
FROM python-base

# Install ExaBGP and dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        softflowd \
    && rm -rf /var/lib/apt/lists/*

RUN pip3 install --break-system-packages \
    exabgp \
    fastapi \
    uvicorn[standard] \
    starlette \
    docker

WORKDIR /app

# Copy unified API code
COPY api-routing /app/api-routing

# Copy entrypoint
COPY docker_base/exabgp-unified/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Default ExaBGP config directory
RUN mkdir -p /etc/exabgp

EXPOSE 5000

CMD ["/entrypoint.sh"]
